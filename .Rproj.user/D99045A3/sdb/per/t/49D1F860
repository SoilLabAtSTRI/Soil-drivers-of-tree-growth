{
    "collab_server" : "",
    "contents" : "# Utility functions\n\nGetGrowthModelData <- function( noSwamp=F )\n{\n  # Kriged soil data\n  df.soil <- read.csv( paste0( dataPath, \"kriged soils-10m.csv\" ) )\n  \n  # Get the presaved growth data with light\n  df <- readRDS( paste( growthDataPath, \"DBH growth data with light-2005-2010.rds\", sep=\"\" ) )\n  \n  # Remove the 20m edges of the plot\n  df <- subset( df, binX >= 20 & binX <= 980 & binY >= 20 & binY <= 480 )\n  df <- merge( df, df.soil, by.x=c(\"binX\",\"binY\"), by.y=c(\"x\",\"y\") )\n  \n  if ( noSwamp ) {\n    # Remove the swamp\n    df.swamp <- read.csv( paste0( dataPath, \"BCI swamp.csv\" ) )\n    library(spatstat)\n    w <- owin( poly=df.swamp )\n    sel <- inside.owin( df$gx, df$gy, w )\n    df.tmp <- df[ sel, ]\n    df <- df[ !( df$tag %in% df.tmp$tag ), ]\n  }\n  \n  # Filter out those species with too few (<=10) individuals\n  tab <- table( df$sp )\n  species <- names( tab[ tab > 10 ] )\n  df <- subset( df, sp %in% species )\n  \n  # Standardise all predictor variables\n  df$M3P <- scale( df$M3P )\n  df$Mn3 <- scale( df$M3Mn )\n  df$Al3 <- scale( df$M3Al )\n  df$K3 <- scale( df$M3K )\n  df$pH <- scale( df$pH_water )\n  df$l.slope <- scale( log(df$slope ) ) # log-transformed slope due to log-normal distribution\n  df$light <- rowMeans( df[ , c(\"light2005\",\"light2006\",\"light2007\",\"light2008\",\"light2009\",\"light2010\")] )\n  df$l.light <- scale( log(df$light) )\n  df$l.dbh <- scale( log(df$dbh) )\n  \n  # Reduce the size of the df so that the model object isn't bloated unnecessarily\n  df <- df[, c(\"tag\", \"sp\", \"incgr\", \"l.slope\", \"l.dbh\", \"dbh\", \"l.light\", \"pH\", \"M3P\", \"Mn3\", \"Al3\",\"K3\",\"convex\" ) ]\n  df\n}\n\n# GetDistributionAffinities\n# Returns a df with the distributional affinities of tree species across the Panama isthmus,\n# as identified in the Condit et al 2013 PNAS paper, for the given tree species.\n# The affinities correspond to the first order affinities, not the second order ones.\nGetDistributionAffinities <- function( species )\n{\n  df <- read.csv( paste0( rawDataPath, \"TreeCommunityDrySeasonSpeciesResponse.csv\") )\n  \n  df.result <- data.frame()\n  for ( i in 1:length(species) ) {\n    df.tmp <- df[ grepl( species[i], df$Latin), 3:11]\n    if ( nrow(df.tmp) > 0 ) {\n      df.tmp$sp <- species[i]\n      df.tmp <- df.tmp[, c(ncol(df.tmp), 1:(ncol(df.tmp) - 1))]\n      df.result <- rbind( df.result, df.tmp )\n    }\n  }\n  df.result\n}\n\nGetQuadratIndices <- function( x, y, gridSize=20 )\n{\n  xCentre <- floor( x / gridSize )*gridSize + gridSize*0.5\n  yCentre <- floor( y / gridSize )*gridSize + gridSize*0.5\n  return( data.frame( binX=xCentre, binY=yCentre ) )\n}\n\nGetModelSoilTopoCorrelations <- function()\n{\n  df.slope <- read.csv( paste0( dataPath, \"BCI topography.csv\" ) )\n  df.soil <- read.csv( paste0( dataPath, \"kriged soils-10m.csv\" ) )\n\n  df <- merge( df.soil, df.slope, by.x=c(\"x\",\"y\"), by.y=c(\"binX\", \"binY\") )\n  \n  vars <- c( \"M3P\", \"M3Mn\", \"M3Al\", \"M3K\", \"convex\", \"slope\", \"pH_water\", \"M3Ca\" )\n  logs <- c( F, F, F, F, F, T, F, F )\n  df <- df[ , vars ]\n  for ( i in 1:length(vars) ) {\n    if ( !logs[i] ) df[,vars[i]] <- scale( df[,vars[i]] )\n    else df[,vars[i]] <- scale( log( df[,vars[i]] ) )\n  }\n  cor( df )\n}\n\nr2.Xu <- function( model )\n{\n  1 - var(residuals(model)) /\n    var(getResponse(model))\n}\n\n\n\n",
    "created" : 1527228890539.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2058320197",
    "id" : "49D1F860",
    "lastKnownWriteTime" : 1526997650,
    "last_content_update" : 1526997650,
    "path" : "~/R/Github/Soil-drivers-of-tree-growth/Source/Utilities.R",
    "project_path" : "Source/Utilities.R",
    "properties" : {
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}